pipeline {
  agent any

  tools {
    maven 'maven'
  }

  options {
    buildDiscarder(logRotator(numToKeepStr: '5'))
  }

  stages {
    stage('Build') {
      steps {
        sh 'mvn clean install site surefire-report:report'
        archiveArtifacts artifacts: 'target/site/**', fingerprint: true
      }
    }
  }

  post {
    success {
      publishHTML([
        allowMissing: false, 
        alwaysLinkToLastBuild: true, 
        keepAll: true, 
        reportDir: 'target/site', 
        reportFiles: 'surefire-report.html', 
        reportName: 'Surefire Report',
        useWrapperFileDirectly: false
      ])
    }
  }
}
